# GGABA (가바) — 비공개 역경매 인테리어 플랫폼

소비자가 시공 요청을 올리면, 시공사들이 서로의 가격을 모른 채 입찰하는 **Blind Reverse Auction** 플랫폼입니다.
하나의 앱에서 **소비자 모드**와 **시공사 모드**를 전환하며 사용할 수 있습니다.

## 기술 스택

| 영역 | 기술 |
|------|------|
| 프레임워크 | Next.js 14 (App Router) |
| 언어 | TypeScript |
| 모노레포 | Turborepo + pnpm workspaces |
| DB / Auth | Supabase (PostgreSQL, Auth, Realtime, Storage) |
| ORM | Drizzle ORM |
| 상태 관리 | Zustand (클라이언트), TanStack Query v5 (서버) |
| UI | shadcn/ui + Tailwind CSS |

## 프로젝트 구조

```
ggaba/
├── apps/web/          # Next.js 웹 앱
├── packages/db/       # Drizzle 스키마, 마이그레이션
├── packages/ui/       # 공통 UI 컴포넌트 (Button, Card, BottomNav 등)
├── packages/lib/      # 유틸리티 (format, cn 등)
└── packages/config/   # 공통 설정 (tsconfig, tailwind)
```

---

## 페이지별 기능 안내

### 홈 (`/`)

앱에 처음 진입하면 보이는 메인 화면입니다.

- **"시공 요청하기" 버튼**: 소비자가 인테리어 시공 요청(역경매)을 시작하는 진입점입니다.
- **경매 현황 위젯**: 현재 진행 중인 경매 수와 총 입찰 수를 보여줍니다.
- **인기 게시글**: 커뮤니티에서 조회수가 높은 게시글 3개를 미리보기로 보여줍니다.

---

### 로그인 (`/login`)

카카오 또는 구글 소셜 로그인을 지원합니다. 로그인 후 첫 방문이면 온보딩 페이지로 이동합니다.

---

### 온보딩

#### 소비자 온보딩 (`/onboarding`)
- 회원가입 직후 닉네임을 설정하는 단계입니다.

#### 시공사 온보딩 (`/onboarding/contractor`)
- 시공사 모드로 전환하려면 사업자 정보를 등록해야 합니다.
- **입력 항목**: 상호명, 사업자번호, 대표자명, 연락처, 전문 분야, 시공 가능 지역

---

### 경매 (소비자)

#### 경매 요청 만들기 (`/auction/new`)
소비자가 시공 요청을 등록하는 5단계 위저드입니다.

1. **지역 선택** — 시공 희망 지역
2. **평수 입력** — 시공 면적
3. **예산 범위** — 최소~최대 예산
4. **시공 일정** — 희망 시공 시기
5. **상세 설명** — 제목과 요청 사항 작성

등록이 완료되면 경매가 시작되고, 시공사들의 입찰을 받을 수 있습니다.

#### 내 경매 목록 (`/auction`)
내가 등록한 경매 요청을 한눈에 볼 수 있습니다.

- 상태별 필터: 진행중 / 입찰중 / 선택완료 / 시공중 / 완료
- 각 카드에 지역, 평수, 예산, 입찰 수, 현재 상태가 표시됩니다.

#### 경매 상세 (`/auction/[id]`)
개별 경매의 상세 정보와 현황을 확인합니다.

- **실시간 입찰자 수**: 30초마다 자동 업데이트
- **마감 카운트다운**: 남은 시간을 실시간으로 표시
- **상태 흐름**: 접수 → 입찰중 → 선택완료 → 시공중 → 완료
- 입찰이 들어오면 비교 페이지로 이동할 수 있습니다.

#### 입찰 비교 (`/auction/[id]/compare`)
수신된 입찰을 나란히 비교하는 페이지입니다.

- **컬러 코딩**: 최저가는 초록, 최고가는 빨강으로 표시되어 직관적으로 비교할 수 있습니다.
- 각 입찰의 총액, 시공사 메시지, 제출일을 확인합니다.
- **"이 입찰 선택"** 버튼으로 시공사를 선택하면 자동으로 1:1 채팅방이 생성됩니다.
- 선택된 입찰의 시공사 프로필 페이지로 이동할 수 있습니다.
- 허위 입찰이 의심되면 **신고 버튼**으로 신고할 수 있습니다.

---

### 입찰 (시공사)

#### 입찰 가능 경매 목록 (`/bids`)
시공사 모드에서 볼 수 있는 공개 경매 목록입니다.

- **필터**: 지역, 평수 범위로 관심 있는 경매를 찾을 수 있습니다.
- 이미 입찰한 경매에는 "입찰 완료" 뱃지가 표시됩니다.
- 무한 스크롤로 목록을 탐색합니다.

#### 입찰 제출 (`/bids/[auctionId]/submit`)
경매에 입찰하는 페이지입니다.

- 경매 요청의 상세 정보(지역, 평수, 예산 등)를 먼저 확인합니다.
- **항목별 단가 입력**: 카테고리 → 세부항목 → 단위 → 단가 순서로 입력하며, 합계가 자동 계산됩니다.
- 시공사 코멘트를 추가로 작성할 수 있습니다.
- **Blind 방식**: 다른 시공사의 입찰 내용은 절대 볼 수 없습니다.
- 같은 경매에 중복 입찰은 불가능합니다.

#### 내 입찰 내역 (`/bids/my`)
내가 제출한 입찰의 결과를 확인합니다.

- 상태별 필터: 제출됨 / 선택됨 / 미선택
- 선택된 입찰은 채팅방으로 바로 이동할 수 있습니다.

---

### 채팅

#### 채팅 목록 (`/chat`)
나와 연결된 모든 채팅방을 보여줍니다.

- 마지막 메시지 미리보기와 읽지 않은 메시지 수가 표시됩니다.

#### 1:1 채팅방 (`/chat/[roomId]`)
소비자와 시공사가 실시간으로 소통하는 공간입니다.

- **실시간 메시지**: Supabase Realtime을 통해 새 메시지가 즉시 표시됩니다.
- **읽음 확인**: 상대방이 메시지를 읽으면 읽음 표시가 업데이트됩니다.
- **에스크로 상태 바**: 계약 체결 → 착수금 → 시공중 → 완료 → 정산의 진행 상황을 보여줍니다. (UI만 구현, 실제 결제 연동 예정)
- **리뷰 작성 버튼**: 소비자가 시공사에 대한 리뷰를 남길 수 있는 바로가기입니다.

---

### 포트폴리오 (시공사)

#### 포트폴리오 목록 (`/portfolio`)
시공사 본인의 포트폴리오를 관리하는 페이지입니다.

- Before/After 이미지 수, 지역, 평수, 비용 등이 카드로 표시됩니다.
- 새 포트폴리오를 작성하거나 기존 항목을 편집/삭제할 수 있습니다.

#### 포트폴리오 작성 (`/portfolio/write`)
새 시공 사례를 등록합니다.

- **입력 항목**: 제목, 설명, 지역, 평수, 시공 기간, 비용
- **이미지 업로드**: Before/After 시공 사진을 Supabase Storage에 업로드합니다.

#### 포트폴리오 상세 (`/portfolio/[id]`)
포트폴리오의 상세 내용과 Before/After 갤러리를 보여줍니다. 본인의 포트폴리오인 경우 수정 버튼이 나타납니다.

#### 포트폴리오 수정 (`/portfolio/[id]/edit`)
기존 포트폴리오를 수정합니다. 소유자만 접근할 수 있으며 기존 데이터가 자동으로 채워집니다.

---

### 시공사 프로필 (`/contractor/[id]`)

소비자가 시공사의 정보를 열람하는 공개 프로필 페이지입니다.

- **프로필 카드**: 상호명, 전문 분야 칩, 시공 가능 지역 칩, 사업자 인증 뱃지
- **통계**: 포트폴리오 건수, 리뷰 건수, 평균 별점
- **포트폴리오 갤러리**: 시공사의 사례를 가로 스크롤로 탐색
- **리뷰 목록**: 다른 소비자들이 남긴 별점과 후기

---

### 커뮤니티

#### 게시글 목록 (`/community`)
인테리어 관련 정보를 공유하는 커뮤니티입니다.

- **탭 필터**: 전체 / 견적공유 / 시공후기 / 질문 / 시공팁 / 자재정보
- 시공사가 작성한 글에는 "시공사" 뱃지가 표시됩니다.
- "시공팁"과 "자재정보" 탭은 시공사 모드에서만 글을 작성할 수 있습니다.

#### 게시글 작성 (`/community/write`)
새 게시글을 작성합니다.

- 카테고리 선택, 제목, 본문 입력
- 견적 공유 시 금고에 저장된 견적서를 첨부할 수 있습니다.
- 가격/이미지 마스킹 옵션으로 민감 정보를 숨길 수 있습니다.

#### 게시글 상세 (`/community/[id]`)
게시글의 전체 내용과 댓글을 볼 수 있습니다.

- 첨부된 견적서가 있으면 바가지 점수, 항목별 단가 테이블이 표시됩니다.
- **투표**: 싸다 / 적당하다 / 비싸다 로 의견을 표현할 수 있습니다.
- **댓글/대댓글**: 트리 구조로 표시되며 답글을 달 수 있습니다.
- 다른 사용자의 게시글이나 댓글에 **신고 버튼**이 표시됩니다.

---

### 리뷰 작성 (`/reviews/write`)

시공이 완료된 후 소비자가 시공사에게 리뷰를 남기는 페이지입니다.

- **별점**: 1~5점
- **텍스트 리뷰**: 최소 10자 이상
- **사진 첨부**: Supabase Storage에 업로드
- 같은 경매/시공사에 대한 중복 리뷰는 방지됩니다.
- 채팅방 헤더의 "리뷰 작성" 버튼에서 진입합니다.

---

### 마이페이지 (`/mypage`)

내 프로필과 활동을 관리하는 페이지입니다.

- **프로필 카드**: 아바타, 닉네임(인라인 수정 가능), 이메일, 티어 뱃지
- **포인트**: 현재 보유 포인트 표시
- **모드 전환**: 소비자 ↔ 시공사 모드를 전환합니다. 시공사 등록이 안 된 경우 온보딩으로 이동합니다.
- **활동 탭**: "내 게시글"과 "내 댓글" 탭에서 내가 작성한 콘텐츠를 확인합니다.
- **로그아웃**

---

### 관리자 페이지

일반 사용자는 접근할 수 없으며, `admin` 역할을 가진 계정만 사용할 수 있습니다.

#### 관리자 대시보드 (`/admin`)
- **신고 관리 카드**: 미처리 신고 건수가 뱃지로 표시됩니다.
- **페널티 관리 카드**: 경고/정지 부여 및 관리 페이지로 이동합니다.

#### 신고 관리 (`/admin/reports`)
접수된 신고를 목록으로 조회하고 처리합니다.

- **탭 필터**: 대기 / 검토중 / 처리완료 / 기각
- 무한 스크롤로 목록을 탐색합니다.

#### 신고 상세 (`/admin/reports/[id]`)
개별 신고의 상세 정보를 확인하고 처리합니다.

- 신고자 정보, 대상 사용자 정보, 신고 사유를 확인합니다.
- **대상 콘텐츠 미리보기**: 신고된 게시글/댓글/입찰의 내용을 바로 확인할 수 있습니다.
- **처리 옵션**: 처리 완료 / 기각 / 페널티 부여 (경고 또는 이용정지)
- 관리자 메모를 남길 수 있습니다.

#### 페널티 관리 (`/admin/penalties`)
사용자에게 부여된 페널티를 관리합니다.

- **필터**: 전체 / 활성 / 해제됨
- **페널티 부여 폼**: 대상 사용자 ID, 유형(경고/이용정지), 사유, 만료일을 입력하여 직접 부여할 수 있습니다.
- 활성 상태의 페널티는 해제할 수 있습니다.

---

### 하단 네비게이션 (BottomNav)

모드에 따라 탭 구성이 바뀝니다.

| 소비자 모드 | 시공사 모드 |
|-------------|-------------|
| 홈 | 입찰목록 |
| 경매 | 포트폴리오 |
| 채팅 | 채팅 |
| 커뮤니티 | 커뮤니티 |
| 마이 | 마이 |

로그인, 온보딩, 관리자 페이지에서는 하단 네비게이션이 숨겨집니다.

---

## 신고 시스템

플랫폼 내 부적절한 콘텐츠나 허위 입찰을 신고할 수 있습니다.

- **신고 가능 대상**: 커뮤니티 게시글, 댓글, 입찰
- **신고 사유**: 허위 입찰 / 부적절한 내용 / 스팸 / 허위 정보 / 괴롭힘 / 기타
- 자기 자신의 콘텐츠는 신고할 수 없으며, 같은 대상에 중복 신고도 방지됩니다.
- 신고 버튼은 로그인 상태에서 다른 사용자의 콘텐츠에만 표시됩니다.

---

## 접근 제어

| 경로 | 조건 |
|------|------|
| `/auction/new` | 로그인 + 소비자 모드 |
| `/bids`, `/portfolio/write`, `/portfolio/[id]/edit` | 로그인 + 시공사 모드 |
| `/chat`, `/mypage`, `/onboarding` | 로그인 필수 |
| `/admin/**` | 로그인 + admin 역할 |

비로그인 사용자가 보호된 페이지에 접근하면 로그인 페이지로 리다이렉트되며, 로그인 후 원래 페이지로 돌아옵니다.

---

## 추후 구현 예정 기능

현재 버전에서는 핵심 플로우에 집중했으며, 아래 기능은 외부 서비스 연동이나 운영 데이터 축적 후 구현할 예정입니다.

### 홈 — 인기 시공사 / 최근 리뷰 미리보기
홈 화면에 인기 시공사 추천과 최근 리뷰를 위젯으로 보여주는 기능입니다. 시공사와 리뷰 데이터가 충분히 쌓인 후에 의미 있는 추천이 가능하므로 보류했습니다.

### 입찰 비교 — 항목별 단가 기반 비교
현재는 입찰 총액 기준으로 비교하지만, 향후 카테고리별 m² 단가 또는 개당 단가 기준으로 세부 비교하는 기능을 추가할 예정입니다. bid_items 세부 항목 입력이 보편화되면 구현합니다.

### 입찰 시 포트폴리오 자동 첨부
시공사가 입찰할 때 본인의 포트폴리오가 자동으로 첨부되어 소비자가 바로 확인할 수 있는 기능입니다. 현재는 선택된 입찰에서 시공사 프로필 링크로 수동 확인이 가능합니다.

### 시공사 선택 후 주소/연락처 공개
소비자가 시공사를 선택하면 시공에 필요한 상세 주소와 연락처가 해당 시공사에게만 공개되는 기능입니다. 개인정보 처리 정책 정립 후 구현합니다.

### 채팅 — 이미지/파일 공유
채팅방에서 시공 관련 사진이나 문서를 주고받는 기능입니다. Supabase Storage 연동이 필요하며, 현재는 텍스트 메시지만 지원합니다.

### 에스크로 결제 연동
채팅방에 표시되는 에스크로 진행 상태(계약 체결 → 착수금 → 시공중 → 완료 → 정산)는 현재 UI만 구현되어 있습니다. 실제 PG사 연동을 통한 결제 처리는 추후 구현합니다.

### 자동 플래그 — 가격 이상 감지
최종 시공 금액이 입찰 금액의 115%를 초과할 경우 자동으로 플래그를 걸어 시공사에게 경고하고, 반복 시 계정을 제재하는 기능입니다. 에스크로 결제가 실제로 연동된 후에 구현합니다.

### AI 견적 진단 (v1.0 보존)
견적서를 업로드하면 AI가 항목별 적정 가격을 분석해주는 기능이 Feature Flag로 숨겨져 있습니다. `NEXT_PUBLIC_ENABLE_AI_DIAGNOSIS=true`로 설정하면 활성화됩니다. 역경매 플랫폼 안정화 후 재활용할 예정입니다.
